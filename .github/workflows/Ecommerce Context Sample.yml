name: Ecommerce Context Sample

on:
  workflow_dispatch:

env:
  CURVERSION: V_2025_Q2_R1.1 # Using env local variable

jobs:
  test:
    strategy:
      matrix:
        service: [cart, payment, inventory, user]  # Using matrix
    runs-on: ubuntu-latest
    outputs:
      test-status: ${{ steps.set-status.outputs.status }}
    steps:
      - name: Run tests
        run:  echo "Running tests for ${{ matrix.service }}"

      - id: set-status
        run:  echo "status=success" >> $GITHUB_OUTPUT
          
  deploy:
    needs: test      # Using needs
    if: needs.test.outputs.test-status == 'success' # Using needs and outputs
    runs-on: ubuntu-latest
    env:
      DEPLOY_ENV: ${{ vars.DEPLOY_ENV }} #Using vars - value assigned in repo global
    steps:
      - name: Deploy service
        run: |
          echo "Current Version : $CURVERSION" #Using Local variable
          echo "Deploying services to $DEPLOY_ENV"   #Using Local variable
          echo "Using secret: ${{ secrets.DEPLOY_KEY }}" #Using secrets - value assigned in repo global
          echo "Repository Details: ${{ github.repository }}" # Using github
          echo "Repository OwnerName: ${{ github.repository_owner }}" # Using github
          echo "Repository URL: ${{ github.repositoryUrl }}" # Using github
          echo "Repository Run Attempt - incremented on rerun : ${{ github.run_attempt }}" # Using github
          echo "Repository Run Number - incremented on new run :  ${{ github.run_number }}" # Using github
          echo "Repository Run Id :  ${{ github.run_id }}" # Using github
          echo "Repository Server Url: ${{ github.server_url }}" # Using github
          echo "Work space :  ${{ github.workspace }}" # Using github
          

          
